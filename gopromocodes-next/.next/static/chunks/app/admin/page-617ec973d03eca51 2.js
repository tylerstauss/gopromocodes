(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{3672:function(e,s,t){Promise.resolve().then(t.bind(t,1340)),Promise.resolve().then(t.t.bind(t,8326,23)),Promise.resolve().then(t.t.bind(t,9167,23))},1340:function(e,s,t){"use strict";t.r(s);var r=t(7437),a=t(2265);s.default=()=>{let[e,s]=(0,a.useState)({inProgress:!1,lastRun:null,logs:[],error:null,success:!1}),[t,l]=(0,a.useState)(!1),[o,i]=(0,a.useState)(!1),[n,c]=(0,a.useState)(["all"]),[d,u]=(0,a.useState)(!1),fetchStatus=async()=>{try{let e=await fetch("/api/admin/migration-status");if(e.ok){let t=await e.json();console.log("Fetched migration status:",t),s(t)}else console.error("Failed to fetch migration status:",await e.text())}catch(e){console.error("Error fetching migration status:",e)}},startMigration=async()=>{l(!0),u(!0);try{let e=n.includes("all")?["all"]:n,s=await fetch("/api/admin/migrate-data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tables:e,resetDatabase:o})});if(s.ok){let e=await s.json();console.log("Migration started:",e),await fetchStatus()}else{let e=await s.json();console.error("Failed to start migration:",e),alert("Error: ".concat(e.error||"Failed to start migration"))}}catch(e){console.error("Error starting migration:",e),alert("An error occurred while starting the migration process")}finally{l(!1)}},handleTableSelect=e=>{if("all"===e){c(["all"]);return}let s=n.filter(e=>"all"!==e);0===(s=s.includes(e)?s.filter(s=>s!==e):[...s,e]).length?c(["all"]):c(s)};return(0,a.useEffect)(()=>{let s;let pollStatus=async()=>{d&&e.inProgress&&(await fetchStatus(),s=setInterval(pollStatus,2e3))};return pollStatus(),()=>{s&&clearInterval(s)}},[e.inProgress,d]),(0,r.jsxs)("div",{className:"bg-white shadow-md rounded p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Data Migration"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-gray-700 mb-2",children:"Migrate data from the Heroku PostgreSQL database to your local database."}),e.lastRun&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["Last run: ",new Date(e.lastRun).toLocaleString()]}),e.inProgress&&(0,r.jsxs)("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4",children:[(0,r.jsx)("p",{className:"font-bold",children:"Migration in progress..."}),(0,r.jsx)("p",{children:"Please wait for the process to complete."})]}),e.error&&!e.inProgress&&(0,r.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[(0,r.jsx)("p",{className:"font-bold",children:"Error"}),(0,r.jsx)("p",{children:e.error})]}),e.success&&!e.inProgress&&(0,r.jsxs)("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:[(0,r.jsx)("p",{className:"font-bold",children:"Success"}),(0,r.jsx)("p",{children:"Migration completed successfully."})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Options"}),(0,r.jsxs)("div",{className:"flex items-center mb-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"resetDb",checked:o,onChange:()=>i(!o),className:"mr-2",disabled:e.inProgress}),(0,r.jsx)("label",{htmlFor:"resetDb",className:"text-gray-700",children:"Reset database before migration (will delete all existing data)"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h4",{className:"text-md font-medium mb-2",children:"Tables to migrate:"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{id:"all",label:"All Tables"},{id:"categories",label:"Categories"},{id:"stores",label:"Stores"},{id:"promo_codes",label:"Promo Codes"},{id:"users",label:"Users"},{id:"store_blogs",label:"Store Blogs"},{id:"category_promo_codes",label:"Category-Promo Relationships"},{id:"subscribers",label:"Subscribers"}].map(s=>(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"table-".concat(s.id),checked:n.includes(s.id),onChange:()=>handleTableSelect(s.id),className:"mr-2",disabled:e.inProgress}),(0,r.jsx)("label",{htmlFor:"table-".concat(s.id),className:"text-gray-700",children:s.label})]},s.id))})]})]}),(0,r.jsxs)("div",{className:"flex space-x-4 mb-4",children:[(0,r.jsx)("button",{onClick:startMigration,disabled:e.inProgress||t,className:"px-4 py-2 rounded ".concat(e.inProgress||t?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:t?"Starting...":e.inProgress?"Migration In Progress":"Start Migration"}),(0,r.jsx)("button",{onClick:fetchStatus,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded",children:"Refresh Status"}),(0,r.jsx)("button",{onClick:()=>u(!d),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded",children:d?"Hide Logs":"Show Logs"})]}),d&&(0,r.jsxs)("div",{className:"mt-4",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Migration Logs"}),(0,r.jsx)("div",{className:"bg-gray-800 text-gray-100 p-4 rounded h-80 overflow-y-auto font-mono text-sm",children:0===e.logs.length?(0,r.jsx)("p",{className:"text-gray-400",children:"No logs available"}):e.logs.map((e,s)=>(0,r.jsx)("div",{className:"mb-1",children:e},s))})]})]})}},9167:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),function(e,s){for(var t in s)Object.defineProperty(e,t,{enumerable:!0,get:s[t]})}(s,{suspense:function(){return suspense},NoSSR:function(){return NoSSR}});let r=t(1283);function suspense(){let e=Error(r.NEXT_DYNAMIC_NO_SSR_CODE);throw e.digest=r.NEXT_DYNAMIC_NO_SSR_CODE,e}function NoSSR(e){let{children:s}=e;return s}},622:function(e,s,t){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=t(2265),a=Symbol.for("react.element"),l=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,n={key:!0,ref:!0,__self:!0,__source:!0};function q(e,s,t){var r,l={},c=null,d=null;for(r in void 0!==t&&(c=""+t),void 0!==s.key&&(c=""+s.key),void 0!==s.ref&&(d=s.ref),s)o.call(s,r)&&!n.hasOwnProperty(r)&&(l[r]=s[r]);if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===l[r]&&(l[r]=s[r]);return{$$typeof:a,type:e,key:c,ref:d,props:l,_owner:i.current}}s.Fragment=l,s.jsx=q,s.jsxs=q},7437:function(e,s,t){"use strict";e.exports=t(622)}},function(e){e.O(0,[326,971,472,744],function(){return e(e.s=3672)}),_N_E=e.O()}]);