(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{846:function(e,t,r){Promise.resolve().then(r.bind(r,6719)),Promise.resolve().then(r.t.bind(r,9167,23))},6719:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return SubmitForm}});var s=r(7437),o=r(2265),n=r(4033);function StoreSearch(e){let{onStoreSelect:t,initialSelectedStore:r}=e,[n,l]=(0,o.useState)(""),[i,a]=(0,o.useState)([]),[d,c]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!1),[f,h]=(0,o.useState)(r||null),b=(0,o.useRef)(null);(0,o.useEffect)(()=>{function handleClickOutside(e){b.current&&!b.current.contains(e.target)&&m(!1)}return document.addEventListener("mousedown",handleClickOutside),()=>{document.removeEventListener("mousedown",handleClickOutside)}},[]),(0,o.useEffect)(()=>{if(!n){a([]);return}let e=setTimeout(()=>{c(!0),fetch("/api/stores/search?q=".concat(encodeURIComponent(n))).then(e=>e.json()).then(e=>{a(e),m(!0)}).catch(e=>console.error("Error searching stores:",e)).finally(()=>c(!1))},300);return()=>clearTimeout(e)},[n]);let handleSelect=e=>{h(e),l(""),m(!1),t(e)};return(0,s.jsxs)("div",{className:"relative",ref:b,children:[(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsxs)("div",{className:"relative flex-grow",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search for a store...",value:n,onChange:e=>l(e.target.value),onFocus:()=>n&&m(!0),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"}),d&&(0,s.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,s.jsx)("div",{className:"animate-spin h-5 w-5 border-2 border-blue-500 rounded-full border-t-transparent"})})]})}),f&&(0,s.jsxs)("div",{className:"mt-2 flex items-center justify-between p-2 bg-blue-50 border border-blue-200 rounded-md",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-blue-800",children:f.name}),(0,s.jsx)("button",{type:"button",onClick:()=>{h(null),t(null)},className:"text-blue-500 hover:text-blue-700 focus:outline-none",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),u&&i.length>0&&(0,s.jsx)("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md max-h-60 overflow-auto border border-gray-200",children:(0,s.jsx)("ul",{className:"py-1",children:i.map(e=>(0,s.jsx)("li",{onClick:()=>handleSelect(e),className:"px-3 py-2 cursor-pointer hover:bg-gray-100",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:e.name}),e.domain&&(0,s.jsx)("span",{className:"text-xs text-gray-500",children:e.domain})]})},e.id))})}),u&&n&&0===i.length&&!d&&(0,s.jsxs)("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md border border-gray-200 p-3 text-sm text-gray-500",children:['No stores found matching "',n,'"']})]})}function SubmitForm(e){let{stores:t,categories:r}=e,l=(0,n.useRouter)(),[i,a]=(0,o.useState)(!1),[d,c]=(0,o.useState)(""),[u,m]=(0,o.useState)(null);async function handleSubmit(e){if(e.preventDefault(),a(!0),c(""),!u){c("Please select a store"),a(!1);return}let t=new FormData(e.currentTarget),r={storeId:u.id,categoryId:parseInt(t.get("categoryId")),title:t.get("title"),description:t.get("description"),code:t.get("code"),link:t.get("link"),expires:t.get("expires")?new Date(t.get("expires")):null,freeShipping:"true"===t.get("freeShipping")};try{let e=await fetch("/api/promocodes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!e.ok){let t=await e.json();throw Error(t.message||"Failed to submit promo code")}l.push("/submit/success")}catch(e){c(e instanceof Error?e.message:"Failed to submit promo code")}finally{a(!1)}}return(0,s.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[d&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded",children:d}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"store-search",className:"block text-sm font-medium text-gray-700",children:"Store"}),(0,s.jsxs)("div",{className:"mt-1",children:[(0,s.jsx)(StoreSearch,{onStoreSelect:e=>m(e)}),(0,s.jsx)("input",{type:"hidden",name:"storeId",value:(null==u?void 0:u.id)||""})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"categoryId",className:"block text-sm font-medium text-gray-700",children:"Category"}),(0,s.jsxs)("select",{id:"categoryId",name:"categoryId",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"",children:"Select a category"}),r.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Title"}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,s.jsx)("textarea",{id:"description",name:"description",rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700",children:"Promo Code"}),(0,s.jsx)("input",{type:"text",id:"code",name:"code",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"link",className:"block text-sm font-medium text-gray-700",children:"Affiliate Link"}),(0,s.jsx)("input",{type:"url",id:"link",name:"link",required:!0,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"expires",className:"block text-sm font-medium text-gray-700",children:"Expiration Date"}),(0,s.jsx)("input",{type:"date",id:"expires",name:"expires",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"freeShipping",name:"freeShipping",value:"true",className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,s.jsx)("label",{htmlFor:"freeShipping",className:"ml-2 block text-sm text-gray-700",children:"Free Shipping"})]}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{type:"submit",disabled:i,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:i?"Submitting...":"Submit Promo Code"})})]})}},9167:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{suspense:function(){return suspense},NoSSR:function(){return NoSSR}});let s=r(1283);function suspense(){let e=Error(s.NEXT_DYNAMIC_NO_SSR_CODE);throw e.digest=s.NEXT_DYNAMIC_NO_SSR_CODE,e}function NoSSR(e){let{children:t}=e;return t}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(2265),o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var s,n={},d=null,c=null;for(s in void 0!==r&&(d=""+r),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)l.call(t,s)&&!a.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===n[s]&&(n[s]=t[s]);return{$$typeof:o,type:e,key:d,ref:c,props:n,_owner:i.current}}t.Fragment=n,t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(94)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=846)}),_N_E=e.O()}]);